var InfiniteScroll={domain:"Zimbio",scrollingContainer:"#Content",moreButton:"#moreStoriesButton",scrollEle:null,scrollHeight:0,percentDistance:0.5,loading:false,page_number:1,page_limit:4,start:false,mi_guid:"_mi_guid",mi_order:"_mi_order",mobile:false,special_type:"SlideshowSpecial",zine_guid:null,more_specials:false,init:function(a){InfiniteScroll.domain=a.domain||InfiniteScroll.domain;InfiniteScroll.page_number=a.page_number||InfiniteScroll.page_number;InfiniteScroll.page_limit=a.page_limit||InfiniteScroll.page_limit;InfiniteScroll.percentDistance=a.percentDistance||InfiniteScroll.percentDistance;InfiniteScroll.scrollingContainer=a.scrollingContainer||InfiniteScroll.scrollingContainer;InfiniteScroll.zine_guid=a.zine_guid||InfiniteScroll.zine_guid;InfiniteScroll.special_type=a.special_type||InfiniteScroll.special_type;InfiniteScroll.scrollEle=$(InfiniteScroll.scrollingContainer);InfiniteScroll.more_specials=a.more_specials||InfiniteScroll.more_specials;if(a.mobile){InfiniteScroll.mobile=true}if(a.ads){InfiniteScroll.Ads.init()}InfiniteScroll.startScroll()},checkScroll:function(a){if(InfiniteScroll.loading||!InfiniteScroll.start){return}if(InfiniteScroll.page_number>=InfiniteScroll.page_limit){var b=$(InfiniteScroll.moreButton);if(b.length){b.hide()}return}var c=Browser.getScroll();var d=window.pageYOffset||document.documentElement.scrollTop;InfiniteScroll.scrollHeight=InfiniteScroll.scrollEle.height();if((1-(d/InfiniteScroll.scrollHeight))<=InfiniteScroll.percentDistance){InfiniteScroll.loading=true;InfiniteScroll.page_number++;InfiniteScroll.loadMore(function(){InfiniteScroll.scrollHeight=InfiniteScroll.scrollEle.height;InfiniteScroll.Ads.update();InfiniteScroll.loading=false})}},loadMore:function(a){if(InfiniteScroll.more_specials){Zimbio.moreSpecials.setMobileFlag(InfiniteScroll.mobile);Zimbio.moreSpecials.populate(a,InfiniteScroll.page_number,InfiniteScroll.zine_guid)}else{Zimbio.recentStories.setMobileFlag(InfiniteScroll.mobile);Zimbio.recentStories.populate(a)}},startScroll:function(){InfiniteScroll.start=true;InfiniteScroll.scrollHeight=InfiniteScroll.scrollEle.height();$(window).on("scroll",InfiniteScroll.checkScroll)}};InfiniteScroll.Ads={options:{enabled:true,startIndex:3,repeatIndex:8},counter:1,marker:0,insert:function(c){if(!c||!c.nextSibling){return}if(this.counter!=1){return}var b=document.createElement("div"),d="scrollAd_"+this.counter,a=(this.counter/10).toFixed(1).toString().replace(/\./g,"");b.id=d;b.className="scroll-ad-module embeddedAd";c.parentNode.insertBefore(b,c.nextSibling);c._inserted=true;this.counter++;googletag.cmd.push(function(){var e=Zimbio.Ads.getAdUnitName("MB_Scroll_300x250");googletag.defineSlot(e,[[300,250],[300,360]],d).setTargeting("Scroll",a).addService(googletag.pubads());googletag.display(d)}.bind(this))},update:function(){if(!this.enabled){return}var b=$("#recentStories .recentStoryModule");for(var a=this.marker,c=b.length;a<c;a++){if((a==this.startIndex)||(((a-this.startIndex)%this.repeatIndex)==0)){if(!b[a]._inserted){this.insert(b[a])}}}this.marker=b.length},init:function(a){for(var b in this.options){this[b]=(a&&b in a)?a[b]:this.options[b]}this.update()}};var Zimbio=Zimbio||{};Zimbio.recentStories=(function(){var g="#moreStoriesButton",c="#recentStories",d=".recentStoryModule",f=false,a=false,e=function(k){var j=k.replace(/^\s+|\s+$/g,"");if(!j){f=true;$(g).hide();return}var i=$(c);var h=document.createElement("div");$(h).html(k);i.append(h);if(!(a)){i.append($(g))}},b=function(l){if(f){return}var i;var h=$(c).find(d).last();if(h){var j=h.attr("_mi_guid");var k=h.attr("_mi_order");if(j&&k){i="/more_recent_stories?last_guid="+j+"&last_order="+k+"&mobile="+a}}if(i){$.ajax({url:i,type:"GET"}).done(function(m){e(m);if(l){l()}})}};return{setMobileFlag:function(h){a=h},populate:function(h){b(h)}}})();Zimbio.moreSpecials=(function(){var e=".thumbnail-strip",d=".split3",f=false,a=false,c=function(i){var h=i.replace(/^\s+|\s+$/g,"");if(!h){f=true;return}var g=$(e);g.append(i)},b=function(k,i,h){if(f){return}var j;var g=$(d).last();j="/get_more_specials_footer?zine_guid="+h+"&page_number="+i;if(j){$.ajax({url:j,type:"GET"}).done(function(l){c(l);if(k){k()}})}};return{setMobileFlag:function(g){a=g},populate:function(i,h,g){b(i,h,g)}}})();